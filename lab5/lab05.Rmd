---
title: "Task1"
author: "Martynas Lukosevicius, Alejo Perez Gomez, Shwetha Vandagadde Chandramouly"
date: "04/12/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1: Hypothesis testing

## 1.

```{r, echo = FALSE}
new_df <- read.csv("lottery.csv", sep = ";")
##View(new_df)
## 1
X <- new_df$Day_of_year
Y <- new_df$Draft_No 
plot(X,Y,main="Scatterplot Y versus X", xlab="day of year ", ylab="Draft_no ", pch=19)
```

From the plot lottery looks random

## 2. 

```{r, echo = FALSE}
lw1 <- loess(Y ~ X, data = new_df)
new_df$Y_hat <- predict(lw1, new_df$Day_of_year)
plot(Y ~ X, data=new_df,pch=19,cex=0.1)
lines(X,lw1$fitted,col="red",lwd=3)
```

From estimates we can see that there is some pattern in the data, however its hardly visible.

## 3.

```{r, echo = FALSE}
statis <- function(data, model){
  index_max <- which.max(model$fitted)
  index_min <- which.min(model$fitted)
  
  X_a <- data$Day_of_year[index_min]
  Y_hat_a <- model$fitted[index_min]
  
  X_b <- data$Day_of_year[index_max]
  Y_hat_b <- model$fitted[index_max]
  statistic <- (Y_hat_b - Y_hat_a)/(X_b - X_a)
  return(statistic)
}

library(boot)
fc<- function(data, index){
  data <- as.data.frame(data[index, ])
  loes <- loess(Draft_No ~ Day_of_year, data)
  return(statis(data,loes))
}


# bootstrap
results <- boot(new_df, statistic = fc, R=2000)  # i think I made mistake here about statistics
plot(results)

# h0:0, ha != 0
#data before bootstrap is not centered so we calculate distance from h0 to mean of distribution
diff <- abs(0-mean(results$t))
p_value <- (sum(results$t > (mean(results$t) + diff)) + sum(results$t < (mean(results$t) - diff)))/2000

```
$H_0: t = 0$ - lotery is random

$H_a: t \neq 0$ -lotery is not random

two sided p-value: `r p_value`

p- value is less than 0.05 so we reject null hypothesis, meaning that lotery is not random

## 4.

permutation test function:
$H_0: t = 0$ - lotery is random

$H_a: t \neq 0$ -lotery is not random

```{r}
permutation_test <- function(data, B){
  
  origin_loes <- loess(Draft_No ~ Day_of_year, data)
  t_origin <- statis(data, origin_loes)
  
  stat= numeric(B)
  n = dim(data)[1]
  for(b in 1:B){
    perm_data <- data.frame(data)
    perm_data$Day_of_year = sample(data$Day_of_year, n)
    loes_h1 <- loess(Draft_No ~ Day_of_year, perm_data)
    stat[b] <- statis(perm_data,loes_h1)
  }
  # statistic from original dat

  p_value <- sum(abs(stat) >= abs(t_origin))/B
  return(p_value)
}
```

```{r, echo = FALSE}
res <- permutation_test(new_df,2000)
```

permutation test when B = 2000: p-value = `r res`

## 5.

```{r,echo=FALSE}

new_y <- function(x, alpha){
  beta <- rnorm(1, 183, 10) 
  y <- max(0, min(alpha * x + beta, 366) )
  return(y)
}

#y <- sapply(new_df$Day_of_year, new_y, alpha = 0.2)

### 5-2
# new_dataset <- data.frame(Day_of_year = new_df$Day_of_year, Draft_No = y )
# permutation_test(new_dataset, 200)

### 5-3
new_alpha <-seq(0.1, 10, 0.1)
p_val <- c()
for( i in 1:length(new_alpha)){
  y <- sapply(new_df$Day_of_year,new_y, alpha = new_alpha[i])
  new_dataset <- data.frame(Day_of_year = new_df$Day_of_year, Draft_No = y )
  p_val[i]<-permutation_test(new_dataset,200)
}


```

table bellows shows p values for alpha 0.1:10 by 0.1 for which p is not eequal to 0
```{r, echo=FALSE}
results <- data.frame(alpha=new_alpha,p = p_val)
knitr::kable(t(results[results$p !=0,]))
```

power of the test is: 1-type 2 error.
type 2 error is a probability of failing to reject $H_0$ when $H_a$ is true. We know that our generated data samples are not random. The amount of rejected $H_0:$ `r sum(results$p > 0.05)`. As a result type 2 error is: `r sum(results$p > 0.05)/length(results$p) `, and power of the test is: `r 1-(sum(results$p > 0.05)/length(results$p))`.
